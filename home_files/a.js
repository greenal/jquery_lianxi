(function($){$.fn.extend({linkup:function(options){var __clean=function($s){$s.find('option[value!=""]').remove()};var ___lnp=function($papa,$son){var v=$papa.val();if(v.length==0){__clean($son);return}$.ajax({url:"/ajax/dict",type:"get",data:{type:options.type,id:$papa.val()},success:function(r){__clean($son);$.each(eval(r),function(i,item){$son.append('<option value="'+item.id+'">'+item.text+"</option>")});$son.trigger("change.linkup");$son.change()},error:function(r,a,e){}})};return $(this).each(function(){var $linkup=$(this);var $select1=$linkup.find("select:eq(0)"),$select2=$linkup.find("select:eq(1)"),$select3=$linkup.find("select:eq(2)");$select1.change(function(){if(options.incepting&&options.incepting.call(this,$select1,$select2)!=false){return}___lnp($select1,$select2)});if(!$select3.length){return}$select2.change(function(){setTimeout(function(){___lnp($select2,$select3)},0)})})}})})(jQuery);$.jcrop=function(d,z){var d=d,z=z;if(typeof(d)!=="object"){d=$(d)[0]}if(typeof(z)!=="object"){z={}}if(!("trackDocument" in z)){z.trackDocument=$.browser.msie?false:true}if(!("keySupport" in z)){z.keySupport=$.browser.msie?false:true}var R={trackDocument:false,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,borderOpacity:0.4,handleOpacity:0.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,watchShift:false,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onchange:function(){},onselect:function(){}};var E=R;y(z);var ab=$(d).css({position:"absolute"});t(ab,E.boxWidth,E.boxHeight);var x=ab.width(),A=ab.height(),T=$("<div />").width(x).height(A).addClass(N("holder")).css({position:"relative",backgroundColor:E.bgColor});if(E.addClass){T.addClass(E.addClass)}ab.wrap(T);var F=$("<img />").attr("src",ab.attr("src")).css("position","absolute").width(x).height(A);var g=$("<div />").width(J(100)).height(J(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(F);var I=$("<div />").width(J(100)).height(J(100)).css({zIndex:320});var v=$("<div />").css({position:"absolute",zIndex:300}).insertBefore(ab).append(g,I);var q=E.boundary;var c=$("<div />").addClass(N("tracker")).width(x+(q*2)).height(A+(q*2)).css({position:"absolute",top:j(-q),left:j(-q),zIndex:290,opacity:0}).mousedown(m);var C,Z;var k=M(d),o,D,ac,ad,B,V;if("trueSize" in E){C=E.trueSize[0]/x;Z=E.trueSize[1]/A}var U=function(){var ag=0,aq=0,ae=0,ap=0,ai,af;function ak(av){var av=ah(av);ae=ag=av[0];ap=aq=av[1]}function al(av){var av=ah(av);ai=av[0]-ae;af=av[1]-ap;ae=av[0];ap=av[1]}function at(){return[ai,af]}function an(ax){var aw=ax[0],av=ax[1];if(0>ag+aw){aw-=aw+ag}if(0>aq+av){av-=av+aq}if(A<ap+av){av+=A-(ap+av)}if(x<ae+aw){aw+=x-(ae+aw)}ag+=aw;ae+=aw;aq+=av;ap+=av}function aj(av){var aw=ar();switch(av){case"ne":return[aw.x2,aw.y];case"nw":return[aw.x,aw.y];case"se":return[aw.x2,aw.y2];case"sw":return[aw.x,aw.y2]}}function ar(){if(!E.aspectRatio&&!D){return au()}var aC=E.aspectRatio?E.aspectRatio:D,az=E.minSize,aD=E.maxSize,ay=ae-ag,aE=ap-aq,ax=Math.abs(ay),aA=Math.abs(aE),aw=ax/aA,av,aB;if(aw<aC){aB=ap;w=aA*aC;av=ay<0?ag-w:w+ag;if(av<0){av=0;h=Math.abs((av-ag)/aC);aB=aE<0?aq-h:h+aq}else{if(av>x){av=x;h=Math.abs((av-ag)/aC);aB=aE<0?aq-h:h+aq}}}else{av=ae;h=ax/aC;aB=aE<0?aq-h:aq+h;if(aB<0){aB=0;w=Math.abs((aB-aq)*aC);av=ay<0?ag-w:w+ag}else{if(aB>A){aB=A;w=Math.abs(aB-aq)*aC;av=ay<0?ag-w:w+ag}}}return last=ao(am(ag,aq,av,aB))}function ah(av){if(av[0]<0){av[0]=0}if(av[1]<0){av[1]=0}if(av[0]>x){av[0]=x}if(av[1]>A){av[1]=A}return[av[0],av[1]]}function am(ay,aA,ax,az){var aC=ay,aB=ax,aw=aA,av=az;if(ax<ay){aC=ax;aB=ay}if(az<aA){aw=az;av=aA}return[Math.round(aC),Math.round(aw),Math.round(aB),Math.round(av)]}function au(){var aw=ae-ag;var av=ap-aq;if(O&&(Math.abs(aw)>O)){ae=(aw>0)?(ag+O):(ag-O)}if(e&&(Math.abs(av)>e)){ap=(av>0)?(aq+e):(aq-e)}if(Q&&(Math.abs(av)<Q)){ap=(av>0)?(aq+Q):(aq-Q)}if(l&&(Math.abs(aw)<l)){ae=(aw>0)?(ag+l):(ag-l)}if(ag<0){ae-=ag;ag-=ag}if(aq<0){ap-=aq;aq-=aq}if(ae<0){ag-=ae;ae-=ae}if(ap<0){aq-=ap;ap-=ap}if(ae>x){var ax=ae-x;ag-=ax;ae-=ax}if(ap>A){var ax=ap-A;aq-=ax;ap-=ax}if(ag>x){var ax=ag-A;ap-=ax;aq-=ax}if(aq>A){var ax=aq-A;ap-=ax;aq-=ax}return ao(am(ag,aq,ae,ap))}function ao(av){return{x:av[0],y:av[1],x2:av[2],y2:av[3],w:av[2]-av[0],h:av[3]-av[1]}}return{flipCoords:am,setPressed:ak,setCurrent:al,getOffset:at,moveOffset:an,getCorner:aj,getFixed:ar}}();var S=function(){var al,aj,ae,aq,aB=370;var am={};var ax={};var ah=false;var ap=E.handleOffset;if(E.drawBorders){am={top:an("hline").css("top",$.browser.msie?j(-1):j(0)),bottom:an("hline"),left:an("vline"),right:an("vline")}}if(E.dragEdges){ax.t=aA("n");ax.b=aA("s");ax.r=aA("e");ax.l=aA("w")}E.sideHandles&&aF(["n","s","e","w"]);E.cornerHandles&&aF(["sw","nw","ne","se"]);function an(aG){var aH=$("<div />").css({position:"absolute",opacity:E.borderOpacity}).addClass(N(aG));g.append(aH);return aH}function af(aG,aH){var aI=$("<div />").mousedown(aa(aG)).css({cursor:aG+"-resize",position:"absolute",zIndex:aH});I.append(aI);return aI}function ar(aG){return af(aG,aB++).css({top:j(-ap+1),left:j(-ap+1),opacity:E.handleOpacity}).addClass(N("handle"))}function aA(aI){var aL=E.handleSize,aM=ap,aK=aL,aH=aL,aJ=aM,aG=aM;switch(aI){case"n":case"s":aH=J(100);break;case"e":case"w":aK=J(100);break}return af(aI,aB++).width(aH).height(aK).css({top:j(-aJ+1),left:j(-aG+1)})}function aF(aG){for(i in aG){ax[aG[i]]=ar(aG[i])}}function ay(aN){var aI=Math.round((aN.h/2)-ap),aH=Math.round((aN.w/2)-ap),aL=west=-ap+1,aK=aN.w-ap,aJ=aN.h-ap,aG,aM;"e" in ax&&ax.e.css({top:j(aI),left:j(aK)})&&ax.w.css({top:j(aI)})&&ax.s.css({top:j(aJ),left:j(aH)})&&ax.n.css({left:j(aH)});"ne" in ax&&ax.ne.css({left:j(aK)})&&ax.se.css({top:j(aJ),left:j(aK)})&&ax.sw.css({top:j(aJ)});"b" in ax&&ax.b.css({top:j(aJ)})&&ax.r.css({left:j(aK)})}function ag(aG,aH){F.css({top:j(-aH),left:j(-aG)});v.css({top:j(aH),left:j(aG)})}function au(aG,aH){v.width(aG).height(aH)}function ak(){var aG=U.getFixed();U.setPressed([aG.x,aG.y]);U.setCurrent([aG.x2,aG.y2])}function aw(){if(aq){return ai()}}function ai(){var aG=U.getFixed();au(aG.w,aG.h);ag(aG.x,aG.y);E.drawBorders&&am.right.css({left:j(aG.w-1)})&&am.bottom.css({top:j(aG.h-1)});ah&&ay(aG);aq||aE();E.onchange(s(aG))}function aE(){v.show();ab.css("opacity",E.bgOpacity);aq=true}function aD(){az();v.hide();ab.css("opacity",1);aq=false}function ao(){aD();ab.css("opacity",1);aq=false}function av(){ah=true;ay(U.getFixed());I.show()}function az(){ah=false;I.hide()}function aC(aG){(B=aG)?az():av()}function at(){var aG=U.getFixed();aC(false);ak()}az();g.append($("<div />").addClass(N("tracker")).mousedown(aa("move")).css({cursor:"move",position:"absolute",zIndex:360,opacity:0}));return{updateVisible:aw,update:ai,release:aD,show:aE,hide:ao,enableHandles:av,disableHandles:az,animMode:aC,done:at}}();var P=function(){var ak=function(){},aj=function(){},ag=E.trackDocument;if(!ag){c.mousemove(ae).mouseup(ai).mouseout(ai)}function am(){if(ag){$(document).mousemove(ae).mouseup(ai)}c.css({zIndex:450})}function af(){if(ag){$(document).unbind("mousemove",ae).unbind("mouseup",ai)}c.css({zIndex:290})}function ae(an){ak(L(an))}function ai(an){an.preventDefault();an.stopPropagation();if(o){o=false;aj(L(an));E.onselect(s(U.getFixed()));af();ak=function(){};aj=function(){}}return false}function ah(ao,an){o=true;ak=ao;aj=an;am();return false}function al(an){c.css("cursor",an)}ab.before(c);return{activateHandlers:ah,setCursor:al}}();var a=function(){var aj=$('<input type="radio" />').css({position:"absolute",left:"-30px"}).keydown(af).keyup(ag).blur(ae),ak=$("<div />").css({position:"absolute",overflow:"hidden"}).append(aj);function ai(){if(E.keySupport){aj.show();aj.focus()}}function ae(al){aj.hide()}function ag(am){if(!E.watchShift){return}var an=V,al;V=am.shiftKey?true:false;if(an!=V){if(V&&o){al=U.getFixed();D=al.w/al.h}else{D=0}S.update()}am.stopPropagation();am.preventDefault();return false}function ah(am,al,an){U.moveOffset([al,an]);S.updateVisible();am.preventDefault();am.stopPropagation()}function af(am){if(am.ctrlKey){return true}ag(am);var al=V?10:1;switch(am.keyCode){case 37:ah(am,-al,0);break;case 39:ah(am,al,0);break;case 38:ah(am,0,-al);break;case 40:ah(am,0,al);break;case 27:S.release();break;case 9:return true}return false}if(E.keySupport){ak.insertBefore(ab)}return{watchKeys:ai}}();function j(ae){return""+parseInt(ae)+"px"}function J(ae){return""+parseInt(ae)+"%"}function N(ae){return E.baseClass+"-"+ae}function M(ae){var af=$(ae).offset();return[af.left,af.top]}function L(ae){return[(ae.pageX-k[0]),(ae.pageY-k[1])]}function K(ae){if(ae!=ac){P.setCursor(ae);ac=ae}}function Y(af,ag){k=M(d);P.setCursor(af=="move"?af:af+"-resize");if(af=="move"){return P.activateHandlers(u(ag),W)}var ae=U.getFixed();U.setPressed(U.getCorner(n(af)));P.activateHandlers(G(af,ae),W)}function G(af,ae){return function(ag){if(!E.aspectRatio&&!D){switch(af){case"e":ag[1]=ae.y2;break;case"w":ag[1]=ae.y2;break;case"n":ag[0]=ae.x2;break;case"s":ag[0]=ae.x2;break}}else{switch(af){case"e":ag[1]=ae.y+1;break;case"w":ag[1]=ae.y+1;break;case"n":ag[0]=ae.x+1;break;case"s":ag[0]=ae.x+1;break}}U.setCurrent(ag);S.update()}}function u(af){var ae=af;a.watchKeys();return function(ag){U.moveOffset([ag[0]-ae[0],ag[1]-ae[1]]);ae=ag;S.update()}}function n(ae){switch(ae){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function aa(ae){return function(af){o=true;Y(ae,L(af));af.stopPropagation();af.preventDefault();return false}}function t(ai,af,ah){var ae=ai.width(),ag=ai.height();if((ae>af)&&af>0){ae=af;ag=(af/ai.width())*ai.height()}if((ag>ah)&&ah>0){ag=ah;ae=(ah/ai.height())*ai.width()}C=ai.width()/ae;Z=ai.height()/ag;ai.width(ae).height(ag)}function s(ae){return{x:parseInt(ae.x*C),y:parseInt(ae.y*Z),x2:parseInt(ae.x2*C),y2:parseInt(ae.y2*Z),w:parseInt(ae.w*C),h:parseInt(ae.h*Z)}}function W(af){var ae=U.getFixed();if(ae.w>E.minSelect[0]&&ae.h>E.minSelect[1]){S.enableHandles();S.done()}else{S.release()}P.setCursor("crosshair")}function m(ae){o=true;k=M(d);S.release();S.disableHandles();K("crosshair");U.setPressed(L(ae));P.activateHandlers(b,W);a.watchKeys();ae.stopPropagation();ae.preventDefault();return false}function b(ae){U.setCurrent(ae);S.update()}function p(aw){var ar=aw[0],af=aw[1],ap=aw[2],ae=aw[3];if(B){return}var aq=U.flipCoords(ar,af,ap,ae);var au=U.getFixed();var ai=initcr=[au.x,au.y,au.x2,au.y2];var aj=E.animationDelay;var am=ai[0];var al=ai[1];var ap=ai[2];var ae=ai[3];var av=aq[0]-initcr[0];var ah=aq[1]-initcr[1];var at=aq[2]-initcr[2];var ag=aq[3]-initcr[3];var ao=0;var ak=E.swingSpeed;S.animMode(true);var an=function(){return function(){ao+=(100-ao)/ak;ai[0]=am+((ao/100)*av);ai[1]=al+((ao/100)*ah);ai[2]=ap+((ao/100)*at);ai[3]=ae+((ao/100)*ag);if(ao<100){ax()}else{S.done()}if(ao>=99.8){ao=100}H(ai)}}();function ax(){window.setTimeout(an,aj)}ax()}function H(ae){U.setPressed([ae[0],ae[1]]);U.setCurrent([ae[2],ae[3]]);S.update()}function y(ae){if(typeof(ae)!="object"){ae={}}E=$.extend(E,ae);if(typeof(E.onchange)!=="function"){E.onchange=function(){}}if(typeof(E.onselect)!=="function"){E.onselect=function(){}}}function X(){return s(U.getFixed())}function f(){return U.getFixed()}function r(ae){y(ae);if("setSelect" in ae){H(ae.setSelect);S.done()}}if(typeof(z)!="object"){z={}}if("setSelect" in z){H(z.setSelect);S.done()}var O=E.maxSize[0]||0;var e=E.maxSize[1]||0;var l=E.minSize[0]||0;var Q=E.minSize[1]||0;P.setCursor("crosshair");return{animateTo:p,setSelect:H,setOptions:r,tellSelect:X,tellScaled:f}};$.fn.jcrop=function(a){function b(e){var d=a.useImg||e.src;var c=new Image();var e=e;c.onload=function(){$(e).hide().after(c);e.jcrop=$.jcrop(c,a)};c.src=d}if(typeof(a)!=="object"){a={}}this.each(function(){if(this.jcrop){if(a=="api"){return this.jcrop}else{this.jcrop.setOptions(a)}}else{b(this)}});this.dismiss=function(){$(".jcrop-holder").remove();$(this).show();this.each(function(){this.jcrop=null})};return this};(function(d){d.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(f,e){d.fx.step[e]=function(g){if(g.state==0){g.start=c(g.elem,e);g.end=a(g.end)}g.elem.style[e]="rgb("+[Math.max(Math.min(parseInt((g.pos*(g.end[0]-g.start[0]))+g.start[0]),255),0),Math.max(Math.min(parseInt((g.pos*(g.end[1]-g.start[1]))+g.start[1]),255),0),Math.max(Math.min(parseInt((g.pos*(g.end[2]-g.start[2]))+g.start[2]),255),0)].join(",")+")"}});function a(e){var f;if(e&&e.constructor==Array&&e.length==3){return e}if(f=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e)){return[parseInt(f[1]),parseInt(f[2]),parseInt(f[3])]}if(f=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e)){return[parseFloat(f[1])*2.55,parseFloat(f[2])*2.55,parseFloat(f[3])*2.55]}if(f=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e)){return[parseInt(f[1],16),parseInt(f[2],16),parseInt(f[3],16)]}if(f=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e)){return[parseInt(f[1]+f[1],16),parseInt(f[2]+f[2],16),parseInt(f[3]+f[3],16)]}return b[d.trim(e).toLowerCase()]}function c(g,e){var f;do{f=d.curCSS(g,e);if(f!=""&&f!="transparent"||d.nodeName(g,"body")){break}e="backgroundColor"}while(g=g.parentNode);return a(f)}var b={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})(jQuery);(function(b){b.changeCard=function(d){var f=null;b(".icard-new-wrap").inputCheckNormal({button:"icard-change-sub"});b("#icard-new-name").attr("blanksubmit","true");b("."+d.btnClass).live("click",function(j){f=b(this);if(b("#lay-change-card").css("display")!="block"){var l=layGroupOpen(this);if(l==false){return}var k=b(this),m=k.offset(),h=document.documentElement.clientWidth/2,g=b("#lay-change-card"),n=g.find(".pointer");icardResetGroup();if(m.left>h){var o=g.outerWidth();n.css({left:o-53});g.css({left:m.left-(o-53-32)+d.offsetLeft,display:"block"})}else{n.css({left:32});g.css({left:m.left+d.offsetLeft,display:"block"})}if(g.hasClass("bottom")){var i=g.outerHeight();g.css({top:m.top-i-10-d.offsetTop})}else{g.css({top:m.top+d.offsetTop})}b("."+d.btnClass).removeClass(d.nowBtnClass);k.addClass(d.nowBtnClass);layGroupOpenAfter(this,j)}else{return false}});b("#lay-change-card .normal").click(function(){var g=b("#lay-change-card input.checkbox");g.removeAttr("checked");b(".icard-new-wrap input").val("").blur();b("#no-group-alert").hide();b("#icard-change-con-word").val("").hide();b("#lay-change-card").hide();if(typeof d.closeCallback=="function"){d.closeCallback.call(this,f)}b("."+d.btnClass).removeClass(d.nowBtnClass)});b("#lay-change-card .fresh").click(function(){var g=b("#icard-new-group"),i=g.parent(),k,n=b("#icard-change-sub"),j=b("#icard-change-con-word"),h=b("#icard-new-name").val(),m=b("#no-group-alert"),l=false;if(!h){b("#icard-new-group").removeAttr("checked");b("#no-group-alert").hide()}k=b("#lay-change-card input.checkbox:checked");if(k.length==0){m.html("请选择分组&nbsp;").show();return}m.hide();var q=j.length&&j.val().replace(/^[ 　]+/,"").replace(/[ 　]+$/,"").replace(/\s+$/,"").replace(/^\s+/,"").replace(/\n\n\n+/g,"\n\n\n");if(q.length){if(/^.{0,50}$/.test(q.replace(/\n/g," "))){m.hide()}else{m.html("附言最多50字&nbsp;").show();return}}if(j.length){j.val(q)}if(g.attr("checked")){n.click();if(!b.inputCheckNormal.check(b("#icard-change-sub"))){return}else{if(h){h=h.replace(/</g,"&lt;");i.before('<li gid="@'+h+'" ><input type="checkbox" class="checkbox" checked="checked" /><label class="checkbox" for="" title="'+h+'">'+h+"</label></li>");b(".icard-new-wrap em").hide();l=true}}}var p=c();if(l){icardResetGroup()}p.push(f);var o=layGroupAjax(p,l);if(o==false){return}b("#lay-change-card .normal").click()});b("#icard-new-group").click(function(){if(!b(this).attr("checked")){b(".icard-new-wrap em").hide();b("#no-group-alert").hide()}});if(b.browser.msie){b(".icard-new-wrap cite").unbind("click");b(".icard-new-wrap cite").click(function(){var g=b(this);setTimeout(function(){g.hide();g.siblings("input").focus()},10)})}b("#icard-new-name").focus(function(){b("#icard-new-group").attr("checked","checked");b("#no-group-alert").hide()});b("#lay-change-card li[gid]").live("mouseover",function(){var g=b(this);g.addClass("over")}).live("mouseout",function(){var g=b(this);g.removeClass("over")}).live("click",function(g){if(g.target.nodeName=="INPUT"){return}var h=b(this).find("input");if(h.attr("checked")){h.removeAttr("checked")}else{h.attr("checked","checked")}});b("#icard-change-btn-word").click(function(){b("#icard-change-con-word").toggle();e()});b(window).resize(function(){e()});function e(){var j=b("."+d.nowBtnClass),m=j.offset(),i=document.documentElement.clientWidth/2,h=b("#lay-change-card"),l=h.find(".pointer");if(h.css("display")=="none"){return}if(m.left>i){var k=h.outerWidth();l.css({left:k-53});h.css({left:m.left-(k-53-32)+d.offsetLeft})}else{l.css({left:32});h.css({left:m.left+d.offsetLeft})}if(h.hasClass("bottom")){var g=h.outerHeight();h.css({top:m.top-g-10-d.offsetTop})}else{h.css({top:m.top+d.offsetTop})}}};icardResetGroup=function(k){var t=b("#change-card-group"),m=b("#change-card-group ul"),q=m.find("li"),o=q.length,h=b("#change-card-group input.text").val(),d=b("<ul></ul>");if(!k){for(var n=0;n<o-1;n++){d.append(q.eq(n))}}else{d.append(k)}var p=d.find("li");var r=q.eq(o-1);d.append(r);if(p.length<20){r.show()}else{r.hide()}p=d.find("li");var g=p.length,f=Math.ceil(g/7),e=[];b("#lay-change-card").removeClass("twocol").removeClass("thrcol").remove("onecol");if(f==1){b("#lay-change-card").addClass("onecol")}else{if(f==2){b("#lay-change-card").addClass("twocol")}else{if(f==3){b("#lay-change-card").addClass("thrcol")}}}for(n=0;n<f;n++){e.push(b("<ul></ul>"))}for(n=0;n<g;n++){var l=Math.floor(n/7);e[l].append(p.eq(n))}m.remove();b.each(e,function(u,j){if(u==e.length-1){j.addClass("last")}t.append(j)});var s=b(".icard-new-wrap input").css("width");b(".icard-new-wrap em").css("width",s);b(".icard-new-wrap cite").css("width",s)};layGroupAjax=function(e,d){};layGroupOpen=function(d){};layGroupOpenAfter=function(d){};checkIcardNewGroup=function(){var l=b("#change-card-group label"),k=this.value,h=b("#no-group-alert"),e=b(this).parent().find("em");e.remove();for(var f=0;f<l.length-1;f++){if(k==l.eq(f).text()){h.html("不能重复添加&nbsp;").show();return false}}var g=k.replace(/[^\x00-\xff]/g,"aa"),d=Math.ceil(g.length/2);h.html("分组名过长&nbsp;");if(d>10){h.show();return false}h.html("请填写分组名&nbsp;");if(!d){b("#icard-new-group").removeAttr("checked");b("#no-group-alert").hide();return false}var j=/^[^\,\'\s\<\>\~\`\!\@\#\$\%\^\&\\\/\?]+$/.test(k);h.html("分组名含非法字符&nbsp;");if(j){h.hide();return true}else{h.show();return false}};function c(){var d=[[],[]];b("#change-card-group li[gid]").each(function(){var e=b(this);if(e.find("input:checked").length){d[0].push(e.attr("gid"));d[1].push(e.find("label").text())}});return d}var a=function(){return nowButtonObj}})(jQuery);(function(d){d.fn.extend({beautySelect:function(f){var e={rel:"rel","class":"","p-select":"bs-p-select","p-over":"bs-p-over",over:"bs-over",select:"bs-select",autoWidth:false,autoWidthTitMov:true,autoWidthFontBold:true,autoWidthFontSize:12,autoMax:1000,hasTitle:true,maxLength:6,arrow:"<span></span>"};if(f){d.each(f,function(g,h){e[g]=h})}d(this).each(function(k,o){var q=this,i=d(q),h=q.selectedIndex,g=i.find("option"),n=d("<div>");n.addClass("djBeautySelect").addClass(e["class"]);n.attr(e.rel,i.attr("id"));n.css("z-index",100-k);if(e.autoWidth){n.attr("autowidthfontsize",e.autoWidthFontSize);n.attr("autowidthfontbold",e.autoWidthFontBold);if(e.autoWidthTitMov){n.attr("autowidthtitmov",e.autoWidthTitMov);n.attr("automax",e.autoMax)}}n.append("<p></p><ul></ul>");var l=n.find("ul"),j=n.find("p"),p=0;g.each(function(u,s){var x=d(this),z=x.attr("class"),r=d.trim(x.html()),y=x.val(),t=x.attr("disabled")?"bs-disabled":"",w=e.hasTitle?'title="'+r+'"':"";if(u==h){j.html(e.arrow+r).addClass(z).attr("classselect",e["p-select"]).attr("classover",e["p-over"]);if(e.hasTitle){j.attr("title",r).attr("hasTitle","true")}l.append('<li typeclass="'+z+'" class="'+z+" "+e.select+" "+t+'" rel="'+y+'"'+w+" >"+r+"</li>");if(e.autoWidth&&e.autoWidthTitMov){j.width(b(j,r,e.autoWidthFontSize,e.autoWidthFontBold))}}else{l.append('<li typeclass="'+z+'" class="'+z+" "+t+'" rel="'+y+'"'+w+" >"+r+"</li>")}if(e.autoWidth){p=Math.max(b(j,r,e.autoWidthFontSize,e.autoWidthFontBold),p)}});i.before(n);var m=l.find("li").innerHeight();if(g.length<e.maxLength){l.height(m*g.length)}else{l.height(m*e.maxLength)}i.hide();if(e.autoWidth){if(!e.autoWidthTitMov){j.width(p)}j.width(j.width()+j.find("span").innerWidth());j.width(Math.min(j.width(),e.autoMax));a(l,j,Math.min(p+j.find("span").innerWidth(),e.autoMax))}})}});d(function(){var f="djBeautySelect",e=d("."+f),i=e.find("p"),h=e.find("ul"),g=e.find("li");g.live("mouseover",function(){d(this).addClass("bs-over")}).live("mouseout",function(){d(this).removeClass("bs-over")}).live("click",function(){var o=d(this),k=o.attr("rel"),j=o.html(),s=o.parents("div."+f),r=s.attr("rel"),p=d("#"+r),m=s.find("p"),l=s.find("ul"),n=s.find("li");if(o.hasClass("bs-disabled")){return}n.removeClass("bs-select");o.addClass("bs-select");p.find('option[value="'+k+'"]').attr("selected","selected");p.change();l.hide();m.html("<span></span>"+j).attr("class",o.attr("typeclass"));if(m.attr("hasTitle")=="true"){m.attr("title",j)}if(s.attr("autowidthfontsize")&&s.attr("autowidthtitmov")){var q=b(m,j,s.attr("autowidthfontsize")-0,s.attr("autowidthfontbold")=="true")+m.find("span").innerWidth();m.width(Math.min(q,s.attr("automax")))}});i.live("click",function(){var m=d(this),k=m.parents("div."+f),j=k.attr("rel"),n=d("#"+j),l=k.find("ul");if(n.attr("disabled")){return}n.click();if(l.css("display")=="none"){h.hide();l.show();l.scrollTop(0);i.removeClass(m.attr("classselect"));m.addClass(m.attr("classselect"))}else{l.hide();m.removeClass(m.attr("classselect"))}});i.hover(function(){var l=d(this),k=l.parents("div."+f),j=k.attr("rel"),m=d("#"+j);if(m.attr("disabled")){return}l.addClass(l.attr("classover"))},function(){var l=d(this),k=l.parents("div."+f),j=k.attr("rel"),m=d("#"+j);if(m.attr("disabled")){return}l.removeClass(l.attr("classover"))});d(document).click(function(l){var j=d(l.target),m=j.parents("div."+f),k=true;if(m.length){return}if(j.hasClass(f)){return}d("div."+f).each(function(){var n="#"+d(this).attr("rel");if(d(n)[0]==l.target){k=false;return false}});if(!k){return}h.hide();i.each(function(){var n=d(this);n.removeClass(n.attr("classselect"))})})});function b(e,g,j,i){var f=d("<span>").html(g).appendTo(d("body")).hide().css("font-size",j).css("font-weight",i?"bold":"normal"),h=0;h=f.width()+10;f.remove();return h}function c(g,e,j,i){var f=d("<span>").html(g).appendTo(d("body")).hide().css("font-size",j).css("font-weight",i?"bold":"normal"),h=0;h=f.width()+10;f.remove();return Math.max(h,e)}function a(f,e,i){var g=parseInt(e.css("margin-left"))+parseInt(e.css("margin-right"))+parseInt(e.css("padding-left"))+parseInt(e.css("padding-right"))+parseInt(e.css("border-left-width"))+parseInt(e.css("border-right-width")),h=i+g-parseInt(f.css("padding-left"))-parseInt(f.css("padding-right"))-parseInt(f.css("border-left-width"))-parseInt(f.css("border-right-width"));f.width(h)}})(jQuery);(function(a){a.formValidate={type:{email:/^([a-z\d]+)([\._a-z\d-]+)?@([a-z\d])(([_a-z\d-])+)?(\.[_a-z\d-]+)*\.([a-z]{2,4})$/i,domain:/^(https?:\/\/)([\w-]+\.)+[a-z]{2,4}\b/i,mobile:/^1(3|5|8|4)\d{9}$/,chinamobile:/^1(3[4-9]|4[7]|5[0-2|7-9]|8[7-9])[0-9]{8}$/,numeric:/^[-\+]?\d+(\.\d+)?$/,integer:/^[-\+]?\d+$/,chinese:/^([\u4e00-\u9fa5]+)$/,tel:/^\d{3,4}-?\d{7,8}$/,idcard:/^\d{14}(\d|\d{4}|(\d{3}[xy]))$/i,date:/^(19|20)\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/},textReplace:function(b){if(!b){return""}return b.replace(/^[ 　]+/,"").replace(/[ 　]+$/,"").replace(/^\s+/,"").replace(/\s+$/,"").replace(/\n\n\n+/g,"\n\n\n")},textLength:function(d,b){if(b){var c=d.replace(/[^\x00-\xff]/g,"aa");return Math.ceil(c.length/2)}return d.length},getNumber:function(g,c,d){var f=this.textReplace(g),b=this.textLength(f,d),e=c-b;return e},check:function(){if(arguments.length==1){var b=arguments[0];if(typeof b=="string"){var f=b}else{var i=b}}else{var f=arguments[0];var i=arguments[1]}var h="formvalidatecheck",e=f?a("."+f):a(".formValidateSubmit"),j=e.data(h),c=true,g=true;if(!j){return true}if(i){a.each(j,function(k,d){if(d.input==i){g=d.isOK;return false}});return g}else{a.each(j,function(k,d){if(!d.isOK){c=false;return false}});return c}}};a.fn.extend({formValidate:function(c){var b={button:"formValidateSubmit",blankSubmit:"blanksubmit",rel:"rel",reg:"reg",regTrue:"regtrue",focus:"focuscolor",blankValue:"blankvalue",blankClass:"blankclass"};var d="formvalidatecheck",e=a.formValidate.type;if(c){a.each(c,function(f,g){b[f]=g})}a(this).each(function(){var h=a(this),l=h[0].nodeName=="INPUT",k=h[0].nodeName=="SELECT",f=a("."+b.button),n=h.attr(b.focus),j=n==undefined||n=="true";i();h.bind("blur.formValidateBlur",function(){if(!k&&j){h.removeClass("focus")}var w=h.attr(b.rel)?a("#"+h.attr(b.rel)):h,y=a.formValidate.textReplace(w.val()),z=w.attr(b.reg),x=h.attr(b.blankSubmit),q=h.attr(b.blankValue),A=x==undefined||x=="false",t,u,p,s,o;if(A&&(y==""||h.val()==q)){i();m(false);return}if(!A&&(y==""||h.val()==q)){i();g(true);return}if(!k){w.val(y)}t=w.val().replace(/\n/g,",");if(!z){o=false}else{if(z.slice(0,4)=="fun:"){o=!window[z.slice(4)].call(h[0],t)}else{u=h.attr(b.regTrue)!=="false";p=z in e?e[z]:new RegExp(z);s=p.test(t);o=u?!s:s}}if(o){m(false)}else{m(true)}}).focus(function(){if(!k){h.click()}if(!k&&j){h.addClass("focus")}i(false)});f.click(function(){h.triggerHandler("blur.formValidateBlur")});function m(o){if(arguments.length==0){return}g(o)}function i(){if(k){return}var p=h.attr(b.blankValue);var o=h.attr(b.blankClass);if(p==undefined||p==""){return}if(!arguments.length){var q=h.val();if(q==""||q==p){h.val(p).addClass(o)}else{h.removeClass(o)}}else{var q=h.val();if(q==""||q==p){h.val("").removeClass(o)}}}function g(o){var q=f.data(d),p=false;if(!q){f.data(d,[{input:h[0],isOK:o}]);return}a.each(q,function(s,r){if(r.input==h[0]){r.isOK=o;p=true;return false}});if(!p){q.push({input:h[0],isOK:o})}f.data(d,q)}});return this}})})(jQuery);